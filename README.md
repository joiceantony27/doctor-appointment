# Doctor Appointment System - DevOps Setup

A comprehensive Django-based doctor appointment system with complete DevOps pipeline including Docker containerization, CI/CD, and Azure deployment.

## üöÄ Features

- **Django Application**: Complete doctor appointment booking system
- **Dockerized**: Full containerization with Docker and Docker Compose
- **CI/CD Pipeline**: Automated testing, security scanning, and deployment
- **Azure Deployment**: Production-ready deployment on Azure
- **Database**: PostgreSQL with Redis for caching
- **Security**: SSL/TLS, security headers, rate limiting
- **Monitoring**: Health checks and logging

## üìã Prerequisites

- Docker and Docker Compose
- Azure CLI (for Azure deployment)
- GitHub account (for CI/CD)
- Azure subscription

## üõ†Ô∏è Local Development Setup

### 1. Clone and Setup Environment

```bash
# Clone the repository
git clone <your-repo-url>
cd doctor_appointment

# Copy environment file
cp .env.example .env
# Edit .env with your configuration
```

### 2. Run with Docker Compose

```bash
# Build and start all services
docker-compose up --build

# Run in background
docker-compose up -d

# View logs
docker-compose logs -f web

# Stop services
docker-compose down
```

### 3. Initialize Database

```bash
# Run migrations
docker-compose exec web python manage.py migrate

# Create superuser
docker-compose exec web python manage.py createsuperuser

# Collect static files
docker-compose exec web python manage.py collectstatic --noinput
```

## üåê Production Deployment on Azure

### 1. Prerequisites

```bash
# Install Azure CLI
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash

# Login to Azure
az login

# Set subscription (if you have multiple)
az account set --subscription "your-subscription-id"
```

### 2. Deploy to Azure

```bash
# Make deployment script executable
chmod +x deploy-azure.sh

# Run deployment script
./deploy-azure.sh
```

The script will:
- Create Azure resource group
- Deploy PostgreSQL database
- Deploy Redis cache
- Deploy Container Registry
- Deploy App Service
- Configure all necessary settings

### 3. Configure GitHub Secrets

After deployment, add these secrets to your GitHub repository:

1. Go to GitHub repository ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions
2. Add the secrets from `github-secrets.txt` file generated by the deployment script

Required secrets:
- `AZURE_CREDENTIALS`
- `AZURE_REGISTRY_LOGIN_SERVER`
- `AZURE_REGISTRY_USERNAME`
- `AZURE_REGISTRY_PASSWORD`
- `AZURE_RESOURCE_GROUP`

### 4. Trigger Deployment

```bash
# Push to main branch to trigger CI/CD
git add .
git commit -m "Initial deployment setup"
git push origin main
```

## üîß Configuration

### Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `SECRET_KEY` | Django secret key | Required |
| `DEBUG` | Debug mode | `False` |
| `ALLOWED_HOSTS` | Allowed hosts | `localhost,127.0.0.1` |
| `DB_ENGINE` | Database engine | `django.db.backends.postgresql` |
| `DB_NAME` | Database name | `doctor_appointment_db` |
| `DB_USER` | Database user | `postgres` |
| `DB_PASSWORD` | Database password | Required |
| `DB_HOST` | Database host | `db` |
| `DB_PORT` | Database port | `5432` |
| `REDIS_URL` | Redis URL | `redis://redis:6379/0` |

### Docker Services

- **web**: Django application (port 8000)
- **db**: PostgreSQL database (port 5432)
- **redis**: Redis cache (port 6379)
- **nginx**: Reverse proxy (ports 80, 443)
- **celery**: Background task worker
- **celery-beat**: Task scheduler

## üîÑ CI/CD Pipeline

The GitHub Actions workflow includes:

1. **Testing**: Unit tests with coverage reporting
2. **Security Scanning**: Safety and Bandit security checks
3. **Docker Build**: Build and push to Azure Container Registry
4. **Deployment**: Deploy to Azure App Service
5. **Database Migration**: Run Django migrations
6. **Notifications**: Slack notifications (optional)

## üìä Monitoring and Logging

### Health Checks

- Application health: `https://your-app.azurewebsites.net/health/`
- Database connectivity check
- Redis connectivity check

### Logs

```bash
# View application logs
docker-compose logs -f web

# View all service logs
docker-compose logs -f

# Azure logs
az webapp log tail --name your-app-name --resource-group rg-doctor-appointment
```

## üîí Security Features

- SSL/TLS encryption
- Security headers (HSTS, CSP, etc.)
- Rate limiting
- CSRF protection
- XSS protection
- SQL injection protection
- Secure session management

## üö® Troubleshooting

### Common Issues

1. **Database Connection Error**
   ```bash
   # Check database status
   docker-compose ps db
   # View database logs
   docker-compose logs db
   ```

2. **Static Files Not Loading**
   ```bash
   # Collect static files
   docker-compose exec web python manage.py collectstatic --noinput
   ```

3. **Migration Issues**
   ```bash
   # Reset migrations (development only)
   docker-compose exec web python manage.py migrate --fake-initial
   ```

### Azure Deployment Issues

1. **Container Registry Authentication**
   ```bash
   # Check ACR credentials
   az acr credential show --name your-registry-name
   ```

2. **App Service Logs**
   ```bash
   # Stream logs
   az webapp log tail --name your-app-name --resource-group rg-doctor-appointment
   ```

## üìù Development Workflow

1. **Feature Development**
   ```bash
   # Create feature branch
   git checkout -b feature/new-feature
   
   # Make changes and test locally
   docker-compose up --build
   
   # Run tests
   docker-compose exec web python manage.py test
   ```

2. **Code Quality**
   ```bash
   # Run security checks
   safety check -r requirements.txt
   bandit -r . -x tests/
   
   # Format code
   black .
   isort .
   ```

3. **Deployment**
   ```bash
   # Push to trigger CI/CD
   git push origin feature/new-feature
   
   # Create pull request
   # Merge to main for production deployment
   ```

## üìû Support

For issues and questions:
1. Check the troubleshooting section
2. Review application logs
3. Check GitHub Actions workflow logs
4. Review Azure resource health

## üöÄ Live Deployment Status

- **Azure Web App**: https://doctorapp89ff75c3.azurewebsites.net
- **GitHub Repository**: https://github.com/joiceantony27/doctor-appointment
- **CI/CD Pipeline**: Automated deployment with GitHub Actions

### Deployment Trigger
This commit triggers the automated deployment pipeline to Azure.

## üìÑ License

This project is licensed under the MIT License - see the LICENSE file for details.
